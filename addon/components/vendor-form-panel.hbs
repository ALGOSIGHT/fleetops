<Overlay
    @onLoad={{this.setOverlayContext}}
    @position="right"
    @noBackdrop={{true}}
    @fullHeight={{true}}
    @isResizeble={{or this.isResizable @isResizable}}
    @width={{or this.width @width "600px"}}
>
    <Overlay::Header @hideLeftSection={{true}} @actionsWrapperClass="flex-1 flex-col py-3" class="h-auto-i min-h-[127px]">
        <div class="flex flex-row items-center justify-between w-full mb-4">
            <div class="flex flex-1 space-x-2">
                {{#if this.vendor.id}}
                    <Button @type="default" @icon="car" @helpText="View vendor details" @onClick={{this.onViewDetails}} @disabled={{this.isLoading}} />
                {{/if}}
            </div>
            <div class="flex flex-1 justify-end">
                <div class="mr-2">
                    <Button
                        @icon={{if this.vendor.id "save" "check"}}
                        @type="primary"
                        @text={{if this.vendor.id "Save Vendor" "Create Vendor"}}
                        @onClick={{this.save}}
                        @isLoading={{this.isLoading}}
                    />
                </div>
                <Button
                    @type="default"
                    @icon="times"
                    @helpText={{if this.vendor.id "Cancel edit vendor" "Cancel new vendor"}}
                    @onClick={{this.onPressCancel}}
                    @disabled={{this.isLoading}}
                />
            </div>
        </div>
        <div class="flex flex-row justify-between w-full">
            <div class="flex flex-col flex-1 w-3/4">
                <div class="flex flex-row">
                    <div class="w-14 flex items-center justify-center">
                        <Image src={{this.vendor.photo_url}} @fallbackSrc={{config "defaultValues.vendorImage"}} alt={{this.vendor.name}} height="48" width="48" class="h-12 w-12" />
                        <Attach::Tooltip @class="clean" @animation="scale" @placement={{"top"}}>
                            <InputInfo @text={{this.vendor.public_id}} />
                        </Attach::Tooltip>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-gray-900 dark:text-white text-2xl">
                            {{#if this.vendor.id}}
                                {{this.vendor.displayName}}
                            {{else}}
                                {{#if this.vendor.displayName}}
                                    {{this.vendor.displayName}}
                                {{else}}
                                    <span>New Vendor</span>
                                {{/if}}
                            {{/if}}
                        </h1>
                        <div class="-mt-1">
                            {{#if this.vendor.driver}}
                                <div class="flex flex-row items-center">
                                    <span class="text-sm dark:text-gray-500 text-gray-700 mr-3">{{this.vendor.driver.name}}</span>
                                </div>
                            {{else}}
                                <div class="flex flex-row items-center">
                                    <span class="text-sm dark:text-gray-500 text-gray-700 mr-3">No driver assigned</span>
                                </div>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-end w-1/4">
                <Badge @status={{this.vendor.status}} />
            </div>
        </div>
    </Overlay::Header>

    <Overlay::Body @wrapperClass="new-service-rate-overlay-body px-4 space-y-4 pt-4" @increaseInnerBodyHeightBy={{1000}}>
        <div class="flex-1 space-y-4">
            <ContentPanel @title="Details" @open={{true}} @pad={{true}} @panelBodyClass="bg-white dark:bg-gray-800">
                <div class="grid grid-cols-1 gap-4 lg:grid-cols-2 lg:gap-2">
                    <div class="modal-body-container">
                        {{#if this.onAction}}
                            <InputGroup>
                                <div class="space-x-4 flex">
                                    <button
                                        type="button"
                                        class="outline-none flex-1 rounded-lg bg-white dark:bg-gray-900 border-2 border-transparent px-4 py-2 flex items-center justify-center
                                            {{if (eq this.onAction 'select') 'border-blue-500'}}"
                                        {{on "click" (fn this.onAction "select")}}
                                    >
                                        <div class="mr-2.5">
                                            <FaIcon @icon="handshake" @size="xl" class="text-blue-500" />
                                        </div>
                                        <div>
                                            <span class="text-gray-900 dark:text-gray-100 text-lg">Choose Integrated Vendor</span>
                                        </div>
                                    </button>
                                    <button
                                        type="button"
                                        class="outline-none flex-1 rounded-lg bg-white dark:bg-gray-900 border-2 border-transparent px-4 py-2 flex items-center justify-center
                                            {{if (eq this.onAction 'create') 'border-blue-500'}}"
                                        {{on "click" (fn this.onAction "create")}}
                                    >
                                        <div class="mr-2.5">
                                            <FaIcon @icon="building" @size="xl" class="text-blue-500" />
                                        </div>
                                        <div>
                                            <span class="text-gray-900 dark:text-gray-100 text-lg">Create Custom Vendor</span>
                                        </div>
                                    </button>
                                </div>
                            </InputGroup>
                        {{/if}}

                        {{#if (eq this.onAction "select")}}
                            <div class="grid grid-cols-2 gap-4 lg:grid-cols-3 mb-4">
                                {{#each this.supportedIntegratedVendors as |integratedVendor|}}
                                    <button
                                        type="button"
                                        class="integrated-vendor-button {{if (eq this.selectedIntegratedVendor.code integratedVendor.code) 'selected'}}"
                                        {{on "click" (fn this.selectIntegratedVendor integratedVendor)}}
                                    >
                                        <div>
                                            <img src={{integratedVendor.logo}} alt={{integratedVendor.code}} class="w-20 h-20" width="80" height="80" />
                                        </div>
                                        <div>
                                            <span class="text-sm font-semibold dark:text-white text-lg">{{integratedVendor.name}}</span>
                                        </div>
                                    </button>
                                {{/each}}
                            </div>

                            {{#if this.selectedIntegratedVendor}}
                                <div class="mb-2">
                                    <label class="mb-2 block dark:text-gray-400 text-xs">Credentials</label>
                                    {{#each this.selectedIntegratedVendor.credential_params as |param|}}
                                        <InputGroup
                                            @name={{smart-humanize param.key}}
                                            @value={{mut (get this.integratedVendor.credentials param.key)}}
                                            @helpText={{concat "Optionally supply your own " (smart-humanize param.key) " to configure this vendor."}}
                                        />
                                    {{/each}}
                                </div>
                                <div class="mb-2">
                                    <label class="mb-2 block dark:text-gray-400 text-xs">Options</label>
                                    {{#each this.selectedIntegratedVendor.option_params as |param|}}
                                        {{#if param.options}}
                                            <InputGroup @name={{smart-humanize param.key}}>
                                                <Select
                                                    @value={{mut (get this.integratedVendor.options param.key)}}
                                                    this={{param.options}}
                                                    @optionValue={{param.optionValue}}
                                                    @optionLabel={{param.optionLabel}}
                                                    @humanize={{true}}
                                                    @placeholder={{concat "Select " (smart-humanize param.key)}}
                                                    @onSelect={{fn (mut (get this.integratedVendor.options param.key))}}
                                                />
                                            </InputGroup>
                                        {{else}}
                                            <InputGroup
                                                @name={{smart-humanize param.key}}
                                                @value={{mut (get this.integratedVendor.options param.key)}}
                                                @helpText={{concat "Optionally supply your own " (smart-humanize param.key) " to configure this vendor."}}
                                            />
                                        {{/if}}
                                    {{/each}}
                                </div>
                                <InputGroup @wrapperClass="mb-2">
                                    <Checkbox
                                        @value={{this.integratedVendor.sandbox}}
                                        @label="Sandbox"
                                        @onToggle={{fn (mut this.integratedVendor.sandbox)}}
                                        @alignItems="center"
                                        @labelClass="mb-0i"
                                    />
                                </InputGroup>
                                <div>
                                    <button type="button" class="btn-link text-xs outline-none text-blue-600 hover:text-blue-600 mb-3" {{on "click" this.toggleAdvancedOptions}}>
                                        {{#if this.showAdvancedOptions}}
                                            <span>Hide Advanced</span>
                                        {{else}}
                                            <span>Show Advanced</span>
                                        {{/if}}
                                    </button>
                                    {{#if this.showAdvancedOptions}}
                                        <InputGroup
                                            @name="Custom Host"
                                            @value={{this.integratedVendor.host}}
                                            @helpText="Optionally provide a custom host that should be used for this integration."
                                        />
                                        <InputGroup
                                            @name="Custom Namespace"
                                            @value={{this.integratedVendor.namespace}}
                                            @helpText="Optionally provide a custom namespace or api version that should be used for the integration."
                                        />
                                        <InputGroup
                                            @name="Webhook URL"
                                            @value={{this.integratedVendor.webhook_url}}
                                            @helpText="Integrated vendors will typically require this so that Fleetbase can receive activity updates on the order. Do not change unless you know what you are doing! Changing this may break your order updates!"
                                        />
                                    {{/if}}
                                </div>
                            {{/if}}
                        {{else}}
                            {{#if this.isIntegratedVendor}}
                                <div class="integrated-vendor-button border-0 mb-4">
                                    <div>
                                        <img src={{this.vendor.provider_settings.logo}} alt={{this.vendor.provider_settings.code}} class="w-20 h-20" width="80" height="80" />
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold dark:text-white">{{this.vendor.provider_settings.name}}</h3>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="mb-2 block dark:text-gray-400 text-xs">Credentials</label>
                                    {{#if this.isEditingCredentials}}
                                        {{#each this.vendor.provider_settings.credential_params as |param|}}
                                            <InputGroup
                                                @name={{smart-humanize param.key}}
                                                @value={{mut (get this.vendor.credentials param.key)}}
                                                @helpText={{concat "Optionally supply your own " (smart-humanize param.key) " to configure this vendor."}}
                                            />
                                        {{/each}}
                                        <div class="my-4">
                                            <Button @text="Cancel credentials reset" @type="danger" @size="sm" @icon="times" @onClick={{this.toggleCredentialsReset}} />
                                        </div>
                                    {{else}}
                                        <div>
                                            <div
                                                class="rounded-md border border-blue-300 dark:border-blue-600 bg-blue-100 dark:bg-blue-500 text-blue-900 dark:text-white text-sm px-4 py-2 mb-4"
                                            >
                                                <p class="mb-2">Sensitive credentials can only be reset, to update credentials you must re-enter the credentials.</p>
                                                <Button @type="default" @size="xs" @icon="repeat" @text="Click here to reset" @onClick={{this.toggleCredentialsReset}} />
                                            </div>
                                        </div>
                                        {{#each this.vendor.provider_settings.credential_params as |param|}}
                                            <InputGroup
                                                @name={{smart-humanize param.key}}
                                                @value="*********"
                                                @disabled="true"
                                                @helpText={{concat "Optionally supply your own " (smart-humanize param.key) " to configure this vendor."}}
                                            />
                                        {{/each}}
                                    {{/if}}
                                </div>
                                <div class="mb-2">
                                    <label class="mb-2 block dark:text-gray-400 text-xs">Options</label>
                                    {{#each this.vendor.provider_settings.option_params as |param|}}
                                        {{#if param.options}}
                                            <InputGroup @name={{smart-humanize param.key}}>
                                                <Select
                                                    @value={{mut (get this.vendor.options param.key)}}
                                                    this={{param.options}}
                                                    @optionValue={{param.optionValue}}
                                                    @optionLabel={{param.optionLabel}}
                                                    @humanize={{true}}
                                                    @placeholder={{concat "Select " (smart-humanize param.key)}}
                                                    @onSelect={{fn (mut (get this.vendor.options param.key))}}
                                                />
                                            </InputGroup>
                                        {{else}}
                                            <InputGroup
                                                @name={{smart-humanize param.key}}
                                                @value={{mut (get this.vendor.options param.key)}}
                                                @helpText={{concat "Optionally supply your own " (smart-humanize param.key) " to configure this vendor."}}
                                            />
                                        {{/if}}
                                    {{/each}}
                                </div>
                                <InputGroup @wrapperClass="mb-2">
                                    <Checkbox @value={{this.vendor.sandbox}} @label="Sandbox" @onToggle={{fn (mut this.vendor.sandbox)}} @alignItems="center" @labelClass="mb-0i" />
                                </InputGroup>
                                <div>
                                    <button type="button" class="btn-link text-xs outline-none text-blue-600 hover:text-blue-600 mb-3" {{on "click" this.toggleAdvancedOptions}}>
                                        {{#if this.showAdvancedOptions}}
                                            <span>Hide Advanced</span>
                                        {{else}}
                                            <span>Show Advanced</span>
                                        {{/if}}
                                    </button>
                                    {{#if this.showAdvancedOptions}}
                                        <InputGroup
                                            @name="Custom Host"
                                            @value={{this.vendor.host}}
                                            @helpText="Optionally provide a custom host that should be used for this integration."
                                        />
                                        <InputGroup
                                            @name="Custom Namespace"
                                            @value={{this.vendor.namespace}}
                                            @helpText="Optionally provide a custom namespace or api version that should be used for the integration."
                                        />
                                        <InputGroup
                                            @name="Webhook URL"
                                            @value={{this.vendor.webhook_url}}
                                            @helpText="Integrated vendors will typically require this so that Fleetbase can receive activity updates on the order. Do not change unless you know what you are doing! Changing this may break your order updates!"
                                        />
                                    {{/if}}
                                </div>
                            {{else}}
                                <div class="grid lg:grid-cols-2 grid-cols-1 gap-2 text-xs dark:text-gray-100">
                                    <InputGroup @name="Name" @value={{this.vendor.name}} @wrapperClass="mb-0" @helpText="The vendor's name, typically the name of a business." />
                                    <InputGroup
                                        @name="Email"
                                        @type="email"
                                        @value={{this.vendor.email}}
                                        @wrapperClass="mb-0"
                                        @helpText="The vendor's email, this can be used to trigger emails to the vendor."
                                    />
                                    <InputGroup
                                        @name="Phone"
                                        @type="tel"
                                        @value={{this.vendor.phone}}
                                        @wrapperClass="mb-0"
                                        @helpText="The vendor's phone #, this can be used to trigger SMS or messages to the vendor."
                                    />
                                    <InputGroup
                                        @name="Website"
                                        @value={{this.vendor.website}}
                                        @wrapperClass="mb-0"
                                        @helpText="The vendor's website, optionally add the vendors website for reference."
                                    />
                                    <InputGroup @wrapperClass="mb-0 col-span-2">
                                        <div class="flex items-start justify-between">
                                            <label>
                                                Address
                                            </label>
                                            <div class="mb-1.5 flex flex-row">
                                                {{#if this.vendor.has_place}}
                                                    <Button @type="default" @size="xs" @icon="edit" @text="Edit" @onClick={{this.editAddress}} />
                                                {{/if}}
                                                <Button @type="default" @size="xs" @icon="plus" @text="New" @onClick={{this.newAddress}} />
                                            </div>
                                        </div>

                                        <ModelSelect
                                            @modelName="place"
                                            @selectedModel={{this.vendor.place}}
                                            @placeholder="Select Address"
                                            @triggerClass="form-select form-input"
                                            @infiniteScroll={{false}}
                                            @renderInPlace={{true}}
                                            @onChange={{this.selectAddress}}
                                            as |model|
                                        >
                                            {{model.name}}
                                            -
                                            {{model.street1}}
                                        </ModelSelect>
                                    </InputGroup>

                                    <InputGroup @name="Country" @wrapperClass="mb-0">
                                        <CountrySelect
                                            class="w-full form-input form-select form-datalist"
                                            @value={{this.vendor.country}}
                                            @onChange={{fn (mut this.vendor.country)}}
                                            placeholder="Country"
                                        />
                                    </InputGroup>
                                </div>
                            {{/if}}
                        {{/if}}
                    </div>
                </div>
            </ContentPanel>

            <ContentPanel @title="Avatar" @open={{false}} @pad={{true}} @panelBodyClass="bg-white dark:bg-gray-800">
                <div class="grid grid-cols-1 gap-4 lg:grid-cols-2 lg:gap-2">
                    <div class="input-group mb-2">
                        <InputLabel @labelText="Select map avatar" @helpText="Select an avatar to be used for rendering on maps when using geolocation tracking features." />
                        <FetchSelect
                            @wrapperClass="w-60"
                            @placeholder="Select avatar"
                            @endpoint="vendors/avatars"
                            @selected={{this.vendor.avatar_url}}
                            @optionValue="value"
                            @onChange={{fn (mut this.vendor.avatar_url)}}
                            as |option|
                        >
                            {{titleize (humanize option.key)}}
                        </FetchSelect>
                    </div>
                    <div>
                        <img alt={{this.vendor.public_id}} src={{this.vendor.avatar_url}} class="w-24 h-24" />
                    </div>
                </div>
            </ContentPanel>
        </div>
    </Overlay::Body>
</Overlay>